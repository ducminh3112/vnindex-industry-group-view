/*
 ** STATIC DATA
 */
DanhMuc = [{"symbol":"abb","group":["bank"]}, {"symbol":"acb","group":["bank"]},{"symbol":"bab","group":["bank"]},{"symbol":"bid","group":["bank"]},{"symbol":"bvb","group":["bank"]},{"symbol":"ctg","group":["bank"]},{"symbol":"eib","group":["bank"]},{"symbol":"hdb","group":["bank"]},{"symbol":"klb","group":["bank"]},{"symbol":"lpb","group":["bank"]},{"symbol":"mbb","group":["bank"]},{"symbol":"msb","group":["bank"]},{"symbol":"nab","group":["bank"]},{"symbol":"nvb","group":["bank"]},{"symbol":"ocb","group":["bank"]},{"symbol":"pgb","group":["bank"]},{"symbol":"sgb","group":["bank"]},{"symbol":"shb","group":["bank"]},{"symbol":"ssb","group":["bank"]},{"symbol":"stb","group":["bank"]},{"symbol":"tcb","group":["bank"]},{"symbol":"tpb","group":["bank"]},{"symbol":"vbb","group":["bank"]},{"symbol":"vcb","group":["bank"]},{"symbol":"vib","group":["bank"]},{"symbol":"vpb","group":["bank"]},
{"symbol":"bsr","group":["daukhi"]},{"symbol":"dcm","group":["hoachat"]},{"symbol":"dpm","group":["hoachat"]},{"symbol":"gas","group":["dichvu_hatang"]},{"symbol":"las","group":["hoachat"]},{"symbol":"oil","group":["daukhi"]},{"symbol":"plc","group":["hoachat"]},{"symbol":"plx","group":["daukhi"]},{"symbol":"pow","group":["dichvu_hatang"]},{"symbol":"pps","group":["daukhi"]},{"symbol":"pvb","group":["daukhi"]},{"symbol":"pvc","group":["daukhi"]},{"symbol":"pvd","group":["daukhi"]},{"symbol":"pvm","group":["xaydung_vlxd"]},{"symbol":"pvs","group":["daukhi"]},{"symbol":"pvt","group":["sanpham_dichvu_congnghe"]},{"symbol":"pxl","group":["bds"]},{"symbol":"pxs","group":["xaydung_vlxd"]},{"symbol":"aaa","group":["hoachat"]},{"symbol":"abs","group":["hoachat"]},{"symbol":"aph","group":["hoachat"]},{"symbol":"bfc","group":["hoachat"]},{"symbol":"csv","group":["hoachat"]},{"symbol":"dag","group":["hoachat"]},{"symbol":"ddv","group":["hoachat"]},{"symbol":"dgc","group":["hoachat"]},{"symbol":"dpr","group":["caosu"]},{"symbol":"dri","group":["caosu"]},{"symbol":"gvr","group":["caosu"]},{"symbol":"hai","group":["hoachat"]},{"symbol":"hcd","group":["hoachat"]},{"symbol":"hii","group":["hoachat"]},{"symbol":"ltg","group":["hoachat"]},{"symbol":"nhh","group":["hoachat"]},{"symbol":"pgn","group":["hoachat"]},{"symbol":"phr","group":["caosu"]},{"symbol":"plp","group":["hoachat"]},{"symbol":"pmb","group":["hoachat"]},{"symbol":"qbs","group":["hoachat"]},{"symbol":"sbv","group":["hoachat"]},{"symbol":"stk","group":["hoachat"]},{"symbol":"tdp","group":["hoachat"]},{"symbol":"tsc","group":["hoachat"]},{"symbol":"vhg","group":["hoachat"]},{"symbol":"vnp","group":["hoachat"]},{"symbol":"vps","group":["hoachat"]},{"symbol":"acm","group":["tainguyen"]},{"symbol":"atg","group":["tainguyen"]},{"symbol":"bmc","group":["tainguyen"]},{"symbol":"cst","group":["tainguyen"]},{"symbol":"dhm","group":["tainguyen"]},{"symbol":"khb","group":["tainguyen"]},{"symbol":"ksb","group":["tainguyen"]},{"symbol":"ksh","group":["tainguyen"]},{"symbol":"ksq","group":["tainguyen"]},{"symbol":"lcm","group":["tainguyen"]},{"symbol":"msr","group":["tainguyen"]},{"symbol":"nbc","group":["tainguyen"]},{"symbol":"tc6","group":["tainguyen"]},{"symbol":"tdn","group":["tainguyen"]},{"symbol":"tht","group":["tainguyen"]},{"symbol":"tnt","group":["tainguyen"]},{"symbol":"tvd","group":["tainguyen"]},{"symbol":"vpg","group":["tainguyen"]},{"symbol":"bvg","group":["kimloai"]},{"symbol":"hmc","group":["kimloai"]},{"symbol":"hpg","group":["kimloai"]},{"symbol":"hsg","group":["kimloai"]},{"symbol":"hsv","group":["kimloai"]},{"symbol":"itq","group":["kimloai"]},{"symbol":"kkc","group":["kimloai"]},{"symbol":"kvc","group":["kimloai"]},{"symbol":"nkg","group":["kimloai"]},{"symbol":"nsh","group":["kimloai"]},{"symbol":"pom","group":["kimloai"]},{"symbol":"sha","group":["kimloai"]},{"symbol":"shi","group":["kimloai"]},{"symbol":"smc","group":["kimloai"]},{"symbol":"tlh","group":["kimloai"]},{"symbol":"tns","group":["kimloai"]},{"symbol":"tvn","group":["kimloai"]},{"symbol":"vgs","group":["kimloai"]},{"symbol":"atb","group":["xaydung_vlxd"]},{"symbol":"bcc","group":["xaydung_vlxd"]},{"symbol":"bce","group":["xaydung_vlxd"]},{"symbol":"bmp","group":["xaydung_vlxd"]},{"symbol":"bts","group":["xaydung_vlxd"]},{"symbol":"c32","group":["xaydung_vlxd"]},{"symbol":"c47","group":["xaydung_vlxd"]},{"symbol":"c4g","group":["xaydung_vlxd"]},{"symbol":"c69","group":["xaydung_vlxd"]},{"symbol":"cdo","group":["xaydung_vlxd"]},{"symbol":"cii","group":["xaydung_vlxd"]},{"symbol":"crc","group":["xaydung_vlxd"]},{"symbol":"ctd","group":["xaydung_vlxd"]},{"symbol":"cti","group":["xaydung_vlxd"]},{"symbol":"ctr","group":["xaydung_vlxd"]},{"symbol":"cvn","group":["xaydung_vlxd"]},{"symbol":"dic","group":["xaydung_vlxd"]},{"symbol":"dpg","group":["xaydung_vlxd"]},{"symbol":"dtd","group":["xaydung_vlxd"]},{"symbol":"evg","group":["xaydung_vlxd"]},{"symbol":"fcn","group":["xaydung_vlxd"]},{"symbol":"g36","group":["xaydung_vlxd"]},{"symbol":"gex","group":["sanpham_tieudung"]},{"symbol":"gkm","group":["xaydung_vlxd"]},{"symbol":"hbc","group":["xaydung_vlxd"]},{"symbol":"hid","group":["xaydung_vlxd"]},{"symbol":"hom","group":["xaydung_vlxd"]},{"symbol":"ht1","group":["xaydung_vlxd"]},{"symbol":"hti","group":["xaydung_vlxd"]},{"symbol":"htn","group":["xaydung_vlxd"]},{"symbol":"hu4","group":["xaydung_vlxd"]},{"symbol":"hut","group":["xaydung_vlxd"]},{"symbol":"hvh","group":["xaydung_vlxd"]},{"symbol":"idc","group":["xaydung_vlxd"]},{"symbol":"kdm","group":["xaydung_vlxd"]},{"symbol":"khl","group":["xaydung_vlxd"]},{"symbol":"ksk","group":["xaydung_vlxd"]},{"symbol":"l14","group":["xaydung_vlxd"]},{"symbol":"lcg","group":["xaydung_vlxd"]},{"symbol":"lig","group":["xaydung_vlxd"]},{"symbol":"mst","group":["xaydung_vlxd"]},{"symbol":"nag","group":["xaydung_vlxd"]},{"symbol":"nha","group":["xaydung_vlxd"]},{"symbol":"ntp","group":["xaydung_vlxd"]},{"symbol":"pas","group":["xaydung_vlxd"]},{"symbol":"pc1","group":["xaydung_vlxd"]},{"symbol":"phc","group":["xaydung_vlxd"]},{"symbol":"ptb","group":["xaydung_vlxd"]},{"symbol":"pvv","group":["xaydung_vlxd"]},{"symbol":"pvx","group":["xaydung_vlxd"]},{"symbol":"ros","group":["xaydung_vlxd"]},{"symbol":"s99","group":["xaydung_vlxd"]},{"symbol":"sci","group":["xaydung_vlxd"]},{"symbol":"sd5","group":["xaydung_vlxd"]},{"symbol":"sd6","group":["xaydung_vlxd"]},{"symbol":"sd9","group":["xaydung_vlxd"]},{"symbol":"sdd","group":["xaydung_vlxd"]},{"symbol":"sdp","group":["xaydung_vlxd"]},{"symbol":"sdt","group":["xaydung_vlxd"]},{"symbol":"spi","group":["xaydung_vlxd"]},{"symbol":"svn","group":["xaydung_vlxd"]},{"symbol":"tgg","group":["xaydung_vlxd"]},{"symbol":"tld","group":["xaydung_vlxd"]},{"symbol":"ttb","group":["xaydung_vlxd"]},{"symbol":"v15","group":["xaydung_vlxd"]},{"symbol":"vc1","group":["xaydung_vlxd"]},{"symbol":"vc7","group":["xaydung_vlxd"]},{"symbol":"vcg","group":["xaydung_vlxd"]},{"symbol":"vcs","group":["xaydung_vlxd"]},{"symbol":"ve9","group":["xaydung_vlxd"]},{"symbol":"vgc","group":["xaydung_vlxd"]},{"symbol":"vit","group":["xaydung_vlxd"]},{"symbol":"vmc","group":["xaydung_vlxd"]},{"symbol":"vne","group":["xaydung_vlxd"]},{"symbol":"acv","group":["sanpham_dichvu_congnghe"]},{"symbol":"ddg","group":["sanpham_dichvu_congnghe"]},{"symbol":"dxp","group":["sanpham_dichvu_congnghe"]},{"symbol":"gmd","group":["sanpham_dichvu_congnghe"]},{"symbol":"gtn","group":["sanpham_dichvu_congnghe"]},{"symbol":"hah","group":["sanpham_dichvu_congnghe"]},{"symbol":"hhg","group":["sanpham_dichvu_congnghe"]},{"symbol":"ilb","group":["sanpham_dichvu_congnghe"]},{"symbol":"mhc","group":["sanpham_dichvu_congnghe"]},{"symbol":"pan","group":["sanpham_dichvu_congnghe"]},{"symbol":"php","group":["sanpham_dichvu_congnghe"]},{"symbol":"psp","group":["sanpham_dichvu_congnghe"]},{"symbol":"pvp","group":["sanpham_dichvu_congnghe"]},{"symbol":"ree","group":["sanpham_dichvu_congnghe"]},{"symbol":"sda","group":["sanpham_dichvu_congnghe"]},{"symbol":"sgp","group":["sanpham_dichvu_congnghe"]},{"symbol":"shn","group":["sanpham_dichvu_congnghe"]},{"symbol":"skg","group":["sanpham_dichvu_congnghe"]},{"symbol":"swc","group":["sanpham_dichvu_congnghe"]},{"symbol":"tcd","group":["sanpham_dichvu_congnghe"]},{"symbol":"tcl","group":["sanpham_dichvu_congnghe"]},{"symbol":"tni","group":["sanpham_dichvu_congnghe"]},{"symbol":"tv2","group":["sanpham_dichvu_congnghe"]},{"symbol":"tya","group":["sanpham_dichvu_congnghe"]},{"symbol":"vea","group":["sanpham_dichvu_congnghe"]},{"symbol":"vip","group":["sanpham_dichvu_congnghe"]},{"symbol":"vkc","group":["sanpham_dichvu_congnghe"]},{"symbol":"vna","group":["sanpham_dichvu_congnghe"]},{"symbol":"vos","group":["sanpham_dichvu_congnghe"]},{"symbol":"vsc","group":["sanpham_dichvu_congnghe"]},{"symbol":"vto","group":["sanpham_dichvu_congnghe"]},{"symbol":"vtp","group":["sanpham_dichvu_congnghe"]},{"symbol":"yeg","group":["sanpham_dichvu_congnghe"]},{"symbol":"afx","group":["sanpham_tieudung"]},{"symbol":"agm","group":["sanpham_tieudung"]},{"symbol":"bna","group":["sanpham_tieudung"]},{"symbol":"dbc","group":["sanpham_tieudung"]},{"symbol":"dlg","group":["sanpham_tieudung"]},{"symbol":"ftm","group":["sanpham_tieudung"]},{"symbol":"gdt","group":["sanpham_tieudung"]},{"symbol":"gil","group":["sanpham_tieudung"]},{"symbol":"hax","group":["sanpham_tieudung"]},{"symbol":"hhs","group":["sanpham_tieudung"]},{"symbol":"hng","group":["sanpham_tieudung"]},{"symbol":"hsl","group":["sanpham_tieudung"]},{"symbol":"htm","group":["sanpham_tieudung"]},{"symbol":"idi","group":["sanpham_tieudung"]},{"symbol":"ila","group":["sanpham_tieudung"]},{"symbol":"kdc","group":["sanpham_tieudung"]},{"symbol":"kmr","group":["sanpham_tieudung"]},{"symbol":"lix","group":["sanpham_tieudung"]},{"symbol":"mbg","group":["sanpham_tieudung"]},{"symbol":"mcm","group":["sanpham_tieudung"]},{"symbol":"naf","group":["sanpham_tieudung"]},{"symbol":"pph","group":["sanpham_tieudung"]},{"symbol":"sab","group":["sanpham_tieudung"]},{"symbol":"sav","group":["sanpham_tieudung"]},{"symbol":"sjf","group":["sanpham_tieudung"]},{"symbol":"svd","group":["sanpham_tieudung"]},{"symbol":"tar","group":["sanpham_tieudung"]},{"symbol":"tch","group":["sanpham_tieudung"]},{"symbol":"tdt","group":["sanpham_tieudung"]},{"symbol":"tid","group":["sanpham_tieudung"]},{"symbol":"tlg","group":["sanpham_tieudung"]},{"symbol":"tna","group":["sanpham_tieudung"]},{"symbol":"ttf","group":["sanpham_tieudung"]},{"symbol":"tth","group":["sanpham_tieudung"]},{"symbol":"vhe","group":["sanpham_tieudung"]},{"symbol":"vnh","group":["sanpham_tieudung"]},{"symbol":"voc","group":["sanpham_tieudung"]},{"symbol":"ads","group":["detmay"]},{"symbol":"msh","group":["detmay"]},{"symbol":"tcm","group":["detmay"]},{"symbol":"tng","group":["detmay"]},{"symbol":"vgt","group":["detmay"]},{"symbol":"acl","group":["thuysan"]},{"symbol":"anv","group":["thuysan"]},{"symbol":"cmx","group":["thuysan"]},{"symbol":"fmc","group":["thuysan"]},{"symbol":"hvg","group":["thuysan"]},{"symbol":"mpc","group":["thuysan"]},{"symbol":"ssn","group":["thuysan"]},{"symbol":"vhc","group":["thuysan"]},{"symbol":"lss","group":["miaduong"]},{"symbol":"qns","group":["miaduong"]},{"symbol":"sbt","group":["miaduong"]},{"symbol":"aav","group":["bds"]},{"symbol":"agg","group":["bds"]},{"symbol":"api","group":["bds"]},{"symbol":"asm","group":["bds"]},{"symbol":"bii","group":["bds"]},{"symbol":"ccl","group":["bds"]},{"symbol":"ceo","group":["bds"]},{"symbol":"ckg","group":["bds"]},{"symbol":"cre","group":["bds"]},{"symbol":"csc","group":["bds"]},{"symbol":"dig","group":["bds"]},{"symbol":"drh","group":["bds"]},{"symbol":"dta","group":["bds"]},{"symbol":"dxg","group":["bds"]},{"symbol":"fid","group":["bds"]},{"symbol":"fir","group":["bds"]},{"symbol":"fit","group":["bds"]},{"symbol":"flc","group":["bds"]},{"symbol":"hag","group":["bds"]},{"symbol":"har","group":["bds"]},{"symbol":"hdc","group":["bds"]},{"symbol":"hdg","group":["bds"]},{"symbol":"hld","group":["bds"]},{"symbol":"hpx","group":["bds"]},{"symbol":"hqc","group":["bds"]},{"symbol":"idj","group":["bds"]},{"symbol":"ijc","group":["bds"]},{"symbol":"kdh","group":["bds"]},{"symbol":"kos","group":["bds"]},{"symbol":"ldg","group":["bds"]},{"symbol":"ndn","group":["bds"]},{"symbol":"nrc","group":["bds"]},{"symbol":"ntl","group":["bds"]},{"symbol":"nvl","group":["bds"]},{"symbol":"ogc","group":["bds"]},{"symbol":"pdr","group":["bds"]},{"symbol":"pvl","group":["bds"]},{"symbol":"pwa","group":["bds"]},{"symbol":"qcg","group":["bds"]},{"symbol":"scr","group":["bds"]},{"symbol":"sjs","group":["bds"]},{"symbol":"tdc","group":["bds"]},{"symbol":"tdh","group":["bds"]},{"symbol":"teg","group":["bds"]},{"symbol":"thd","group":["bds"]},{"symbol":"tig","group":["bds"]},{"symbol":"vcr","group":["bds"]},{"symbol":"vhm","group":["bds"]},{"symbol":"vic","group":["bds"]},{"symbol":"vph","group":["bds"]},{"symbol":"vpi","group":["bds"]},{"symbol":"vrc","group":["bds"]},{"symbol":"vre","group":["bds"]},{"symbol":"drc","group":["caosu"]},{"symbol":"bkg","group":["lamnghiep"]},{"symbol":"dhc","group":["lamnghiep"]},{"symbol":"hap","group":["lamnghiep"]},{"symbol":"hhp","group":["lamnghiep"]},{"symbol":"amv","group":["yte"]},{"symbol":"bio","group":["yte"]},{"symbol":"dbt","group":["yte"]},{"symbol":"dcl","group":["yte"]},{"symbol":"ddn","group":["yte"]},{"symbol":"dmc","group":["yte"]},{"symbol":"dnm","group":["yte"]},{"symbol":"dvn","group":["yte"]},{"symbol":"imp","group":["yte"]},{"symbol":"jvc","group":["yte"]},{"symbol":"ldp","group":["yte"]},{"symbol":"tnh","group":["yte"]},{"symbol":"amd","group":["dichvu_tieudung"]},{"symbol":"ast","group":["dichvu_tieudung"]},{"symbol":"dah","group":["dichvu_tieudung"]},{"symbol":"dgw","group":["dichvu_tieudung"]},{"symbol":"ds3","group":["dichvu_tieudung"]},{"symbol":"dst","group":["dichvu_tieudung"]},{"symbol":"frt","group":["dichvu_tieudung"]},{"symbol":"hvn","group":["dichvu_tieudung"]},{"symbol":"klf","group":["dichvu_tieudung"]},{"symbol":"mwg","group":["dichvu_tieudung"]},{"symbol":"pet","group":["dichvu_tieudung"]},{"symbol":"psd","group":["dichvu_tieudung"]},{"symbol":"vjc","group":["dichvu_tieudung"]},{"symbol":"vnb","group":["dichvu_tieudung"]},{"symbol":"vtd","group":["dichvu_tieudung"]},{"symbol":"vtr","group":["dichvu_tieudung"]},{"symbol":"asp","group":["dichvu_hatang"]},{"symbol":"btp","group":["dichvu_hatang"]},{"symbol":"bwe","group":["dichvu_hatang"]},{"symbol":"cng","group":["dichvu_hatang"]},{"symbol":"geg","group":["dichvu_hatang"]},{"symbol":"hnd","group":["dichvu_hatang"]},{"symbol":"khp","group":["dichvu_hatang"]},{"symbol":"nt2","group":["dichvu_hatang"]},{"symbol":"pgc","group":["dichvu_hatang"]},{"symbol":"ppc","group":["dichvu_hatang"]},{"symbol":"qtp","group":["dichvu_hatang"]},{"symbol":"sjd","group":["dichvu_hatang"]},{"symbol":"tdm","group":["dichvu_hatang"]},{"symbol":"tta","group":["dichvu_hatang"]},{"symbol":"vcw","group":["dichvu_hatang"]},{"symbol":"vsh","group":["dichvu_hatang"]},{"symbol":"abi","group":["baohiem"]},{"symbol":"bic","group":["baohiem"]},{"symbol":"bmi","group":["baohiem"]},{"symbol":"bvh","group":["baohiem"]},{"symbol":"mig","group":["baohiem"]},{"symbol":"pvi","group":["baohiem"]},{"symbol":"vnr","group":["baohiem"]},{"symbol":"d2d","group":["bds_kcn"]},{"symbol":"ita","group":["bds_kcn"]},{"symbol":"kbc","group":["bds_kcn"]},{"symbol":"lhg","group":["bds_kcn"]},{"symbol":"nlg","group":["bds_kcn"]},{"symbol":"ntc","group":["bds_kcn"]},{"symbol":"sip","group":["bds_kcn"]},{"symbol":"snz","group":["bds_kcn"]},{"symbol":"szc","group":["bds_kcn"]},{"symbol":"szl","group":["bds_kcn"]},{"symbol":"tip","group":["bds_kcn"]},{"symbol":"vc3","group":["bds_kcn"]},{"symbol":"aas","group":["chungkhoan"]},{"symbol":"agr","group":["chungkhoan"]},{"symbol":"apg","group":["chungkhoan"]},{"symbol":"aps","group":["chungkhoan"]},{"symbol":"art","group":["chungkhoan"]},{"symbol":"bcg","group":["chungkhoan"]},{"symbol":"bms","group":["chungkhoan"]},{"symbol":"bsi","group":["chungkhoan"]},{"symbol":"bvs","group":["chungkhoan"]},{"symbol":"cts","group":["chungkhoan"]},{"symbol":"evs","group":["chungkhoan"]},{"symbol":"fts","group":["chungkhoan"]},{"symbol":"hbs","group":["chungkhoan"]},{"symbol":"hcm","group":["chungkhoan"]},{"symbol":"ibc","group":["chungkhoan"]},{"symbol":"ivs","group":["chungkhoan"]},{"symbol":"mbs","group":["chungkhoan"]},{"symbol":"ors","group":["chungkhoan"]},{"symbol":"psi","group":["chungkhoan"]},{"symbol":"sbs","group":["chungkhoan"]},{"symbol":"shs","group":["chungkhoan"]},{"symbol":"ssi","group":["chungkhoan"]},{"symbol":"tci","group":["chungkhoan"]},{"symbol":"tvb","group":["chungkhoan"]},{"symbol":"tvc","group":["chungkhoan"]},{"symbol":"tvs","group":["chungkhoan"]},{"symbol":"vci","group":["chungkhoan"]},{"symbol":"vds","group":["chungkhoan"]},{"symbol":"vfs","group":["chungkhoan"]},{"symbol":"vig","group":["chungkhoan"]},{"symbol":"vix","group":["chungkhoan"]},{"symbol":"vnd","group":["chungkhoan"]},{"symbol":"wss","group":["chungkhoan"]},{"symbol":"cmg","group":["congnghe"]},{"symbol":"elc","group":["congnghe"]},{"symbol":"fpt","group":["congnghe"]},{"symbol":"ict","group":["congnghe"]},{"symbol":"sam","group":["congnghe"]},{"symbol":"sgt","group":["congnghe"]},{"symbol":"sra","group":["congnghe"]},{"symbol":"vgi","group":["congnghe"]}
];

ChiSo_Index = [ "vnindex", "vn30", "vn30f1m", "fuessvfl", "hnx", "hnx30", "upcom"];

Technical_Strategy = [ "cipShort", "cipLong" ];

ThongKe = [ 
    {"group":"bank","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"daukhi","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"hoachat","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"tainguyen","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"kimloai","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"xaydung_vlxd","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"sanpham_dichvu_congnghe","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"sanpham_tieudung","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"detmay","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"thuysan","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"miaduong","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"bds","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"caosu","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"lamnghiep","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"yte","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"dichvu_tieudung","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"dichvu_hatang","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"bds_kcn","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"chungkhoan","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"congnghe","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"baohiem","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}},
    {"group":"overall","price":{"up":0,"down":0,"sw":0},"long":{"s":0,"ss":0,"b":0,"sb":0},"short":{"s":0,"ss":0,"b":0,"sb":0}, "load":{"success":0, "fail":0}}
]

/*
 ** CONSTANT
 */

const VNDIRECT_API_STOCK_PRICES = "https://finfo-api.vndirect.com.vn/v4/stock_prices/";
const VNDIRECT_API_TECHNICAL_SIGNALS = "https://finfo-api.vndirect.com.vn/v4/technical_signals/";
const VNDIRECT_API_INDEX = "https://finfo-api.vndirect.com.vn/v4/change_prices/";

// Object CoPhieu
function CoPhieu(symbol) {
    this.code = symbol || "";
    this.price = [];
    this.signal = [];
}

function draw_price(price) {
    price.code = price.code.toLowerCase();
    $(`.${price.code}.vol`).each(function(index, el) {
        el.innerHTML = `${(parseInt(price.nmVolume)/1000000).toFixed(2) || 0}M`;
    });
    $(`.${price.code}.close`).each(function(index, el) {
        el.innerHTML = `${price.adClose || 0}`;
    });
    $(`.${price.code}.pctClose`).each(function(index, el) {
        el.innerHTML = `${parseFloat(price.pctChange).toFixed(2) || 0}%`;
    });

    if (true) {
        $(`.${price.code}.pctClose`).each(function(index, el) {
            el.style.background = 'orange';
        });
    }

    // Giá giảm
    if (parseFloat(price.pctChange) < 0) {
        $(`.${price.code}.pctClose`).each(function(index, el) {
            el.style.background = 'red';
        });
    }

    // Giá sàn
    if (
        ((price.floor == "HOSE") && (parseFloat(price.pctChange) < -6.9)) ||
        ((price.floor == "HNX") && (parseFloat(price.pctChange) < -9.9)) ||
        ((price.floor == "UPCOM") && (parseFloat(price.pctChange) < -14.9))
    ) {
        $(`.${price.code}.pctClose`).each(function(index, el) {
            el.style.background = 'cyan';
        });
    }

    // Giá tăng
    if (parseFloat(price.pctChange) > 0) {
        $(`.${price.code}.pctClose`).each(function(index, el) {
            el.style.background = 'lime';
        });
    }

    // Giá trần
    if (
        ((price.floor == "HOSE") && (parseFloat(price.pctChange) > 6.9)) ||
        ((price.floor == "HNX") && (parseFloat(price.pctChange) > 9.9)) ||
        ((price.floor == "UPCOM") && (parseFloat(price.pctChange) > 14.9))
    ) {
        $(`.${price.code}.pctClose`).each(function(index, el) {
            el.style.background = 'violet';
        });
    }
}

function draw_signal (signals) {
    var cipShort = [];
    var cipShort_class = [];
    var cipLong = "";
    var cipLong_class = [];
    (signals).forEach(function(signal) {
        if (signal.strategy == "cipShort") {
            cipShort = signal.totalSignal.match(/\b\w/g).join('')
            if ((cipShort == "S") || (cipShort == "SS")) {
                cipShort_class.push("sell");
            }
            if ((cipShort == "B") || (cipShort == "SB")) {
                cipShort_class.push("buy");
            }
            if ((cipShort == "SS") || (cipShort == "SB")) {
                cipShort_class.push("strong");
            }
        };
        if (signal.strategy == "cipLong") {
            cipLong = signal.totalSignal.match(/\b\w/g).join('')
            if ((cipLong == "S") || (cipLong == "SS")) {
                cipLong_class.push("sell");
            }
            if ((cipLong == "B") || (cipLong == "SB")) {
                cipLong_class.push("buy");
            }
            if ((cipLong == "SS") || (cipLong == "SB")) {
                cipLong_class.push("strong");
            }
        };
    });

    $(`.${signals[0].code.toLowerCase()}.signal`).each(function(index, el) {
        el.innerHTML = `<a class="${cipShort_class.join(" ")}">${cipShort}</a> / <a class="${cipLong_class.join(" ")}">${cipLong}</a>`;
    });  
}

// Object Index
function Index(symbol) {
    this.symbol = symbol || "";
    this.data = [];
}

function draw_index(index) {
    index.code = index.code.toLowerCase();
    $(`.${index.code}.period`).html(`${index.period || "N/A"}`);
    $(`.${index.code}.price`).html(`${index.price.toFixed(2) || "N/A"}`);
    $(`.${index.code}.change`).html(`${index.change.toFixed(2)|| "N/A"}`);
    $(`.${index.code}.changePct`).html(`${index.changePct.toFixed(2) || "N/A"}%`);

    if (true) {
        $(`.${index.code}.changePct`).css('background', 'orange');
    }

    // Index giảm
    if (parseFloat(index.changePct) < 0) {
        $(`.${index.code}.changePct`).css('background', 'red');
    }

    // Index tăng
    if (parseFloat(index.changePct) > 0) {
        $(`.${index.code}.changePct`).css('background', 'lime');
    }
}

function draw (req) {
    if (Object.getPrototypeOf(req) === CoPhieu.prototype) {
        if (req.price.length >0 ) {
            draw_price (req.price[0]);
        }

        if (req.signal.length > 0) {
            draw_signal(req.signal);
        }
    } else if (Object.getPrototypeOf(req) === Index.prototype) {
        draw_index(req.data);
    }
}

/*
 ** Chạy sau khi render
 */
window.onload = function() {
    //
    // NGÀY - GIỜ - PHIÊN
    //
    var today = new Date();

    if (true) {
        var time = today.toLocaleTimeString('en-GB');
        $(`.time.value`).html(`${time}`);
        $(`.time.offset`).css('background', 'lime')
        if ((time < "09:00:00")) {
            $(`.time.offset`).html(`Chưa mở`);
            $(`.time.offset`).css('background', 'red');
        } else if ((time >= "09:00:00") && (time < "09:15:00")) {
            $(`.time.offset`).html(`ATO>LO`);
        } else if ((time >= "09:15:00") && (time < "11:30:00")) {
            $(`.time.offset`).html(`Khớp liên tục`);
        } else if ((time >= "11:30:00") && (time < "13:00:00")) {
            $(`.time.offset`).html(`Nghỉ trưa`);
            $(`.time.offset`).css('background', 'red');
        } else if ((time >= "13:00:00") && (time < "14:30:00")) {
            $(`.time.offset`).html(`Khớp liên tục`);
        } else if ((time >= "14:30:00") && (time < "14:45:00")) {
            $(`.time.offset`).html(`ATC>LO`);
        } else if ((time >= "14:45:00") && (time < "15:00:00")) {
            $(`.time.offset`).html(`PLO`);
        } else if (time >= "15:00:00") {
            $(`.time.offset`).html(`Đóng cửa`);
            $(`.time.offset`).css('background', 'red');
        }
    }

    if (today.getDay() == 6) { // Thứ 7
        today.setDate(new Date(today.getDate() - 1));
        $(`.date.offset`).html(`Hôm qua`);
        $(`.date.offset`).css('background', 'red');
        $(`.date.value`).html(`${today.toLocaleDateString('en-GB').slice(0, 10)}`);
        $(`.time.offset`).html(`Đóng cửa`);
        $(`.time.offset`).css('background', 'red');
    } else if (today.getDay() == 0) { // Chủ Nhật
        today.setDate(new Date(today.getDate() - 2));
        $(`.date.offset`).html(`Hôm kia`);
        $(`.date.offset`).css('background', 'red');
        $(`.date.value`).html(`${today.toLocaleDateString('en-GB').slice(0, 10)}`);
        $(`.time.offset`).html(`Đóng cửa`);
            $(`.time.offset`).css('background', 'red');
    } else {
        $(`.date.offset`).html(`Hôm nay`);
        $(`.date.value`).html(`${today.toLocaleDateString('en-GB').slice(0, 10)}`);
    }

    // 
    // GET REQUEST: Thong tin Index
    //
    $.each(ChiSo_Index, function(i, symbol) {
        let index = new Index(symbol);
        // Assign handlers immediately after making the request,
        // and remember the jqxhr object for this request
        var jqxhr = $.get(
                `${VNDIRECT_API_INDEX}`, {
                    q: `code:${symbol}~period:1D`
                },
                function(result) {
                    // SUCCESS
                    if (result.totalElements > 0) {
                        index.data = result.data[0];
                        draw(index);
                    }
                }, "json")
            .done(function() {
                // 2ND SUCCESS
            })
            .fail(function() {
                // ERROR
                console.log(symbol);
            })
            .always(function() {
                // FINISH
            });

        // Perform other work here ...

        // Set another completion function for the request above
        jqxhr.always(function() {
            // 2ND FINISH
        });
        
    });

    //
    // GET REQUEST: Thong tin co phieu
    //

    let date = today.toISOString("dd/MM/YYYY").slice(0, 10);
    // let date = "2022-01-25";
    let strategy = Technical_Strategy.join(",");
    
    $.each(DanhMuc, function(index, cophieu) {
        let symbol = cophieu.symbol;
        let cp = new CoPhieu(symbol);
        //
        //GET REQUEST: Thong tin giao dich
        //

        // Assign handlers immediately after making the request,
        // and remember the jqxhr object for this request
        var jqxhr = $.get(
                `${VNDIRECT_API_STOCK_PRICES}`, {
                    q: `code:${symbol}~date:gte:${date}~date:lte:${date}`
                },
                function(result) {
                    // SUCCESS
                    cp.price = result.data;
                    draw(cp);

                    let g = ThongKe.find(el => el.group === 'overall');
                    if (cp.price[0].pctChange === 0) {
                        g.price.sw++;
                    } else if (cp.price[0].pctChange < 0) {
                        g.price.down ++;
                    } else if (cp.price[0].pctChange > 0) {
                        g.price.up ++;
                    }
                    $(`.overall.uds`).html(`${g.price.up}/${g.price.down}/${g.price.sw}`);
                    $(`.overall.uds`).css("background", `linear-gradient( to right, lime, lime ${100*g.price.up/(g.price.up+g.price.down+g.price.sw)}%, red ${100*g.price.up/(g.price.up+g.price.down+g.price.sw)}%, red ${100*(g.price.up+g.price.down)/(g.price.up+g.price.down+g.price.sw)}%, orange ${100*(g.price.up+g.price.down)/(g.price.up+g.price.down+g.price.sw)}%, orange 100%)`);
                
                    $.each(cophieu.group, function (index, grp){
                        let g = ThongKe.find(el => el.group === grp);
                        if (cp.price[0].pctChange === 0) {
                            g.price.sw++;
                        } else if (cp.price[0].pctChange < 0) {
                            g.price.down ++;
                        } else if (cp.price[0].pctChange > 0) {
                            g.price.up ++;
                        }
                        $(`.${grp}.uds`).html(`${g.price.up}/${g.price.down}/${g.price.sw}`);
                        $(`.${grp}.uds`).css("background", `linear-gradient( to right, lime, lime ${100*g.price.up/(g.price.up+g.price.down+g.price.sw)}%, red ${100*g.price.up/(g.price.up+g.price.down+g.price.sw)}%, red ${100*(g.price.up+g.price.down)/(g.price.up+g.price.down+g.price.sw)}%, orange ${100*(g.price.up+g.price.down)/(g.price.up+g.price.down+g.price.sw)}%, orange 100%)`);
                    });
                }, "json")
            .done(function() {
                // 2ND SUCESS
            })
            .fail(function() {
                // ERROR
                console.log(symbol);
            })
            .always(function() {
                // FINISH
            });

        // Perform other work here ...

        // Set another completion function for the request above
        jqxhr.always(function() {
            // 2ND FINISH
        });

        // 
        //GET REQUEST: Chi bao ky thuat
        //

        // Assign handlers immediately after making the request,
        // and remember the jqxhr object for this request
        var jqxhr = $.get(
                `${VNDIRECT_API_TECHNICAL_SIGNALS}`, 
                {
                    q: `strategy:${strategy}~code:${symbol}`
                },
                function(result) {
                    // SUCCESS
                    cp.signal = result.data;
                    draw(cp);

                    $.each(cophieu.group, function (index, grp){
                        let g = ThongKe.find(el => el.group === grp);
                        $.each(cp.signal, function(index, sgn){
                            if (sgn.strategy === 'cipLong'){
                                if (sgn.totalSignal === 'SELL') {
                                    g.long.s ++;
                                } else if (sgn.totalSignal === 'STRONG SELL') {
                                    g.long.ss ++;
                                } else if (sgn.totalSignal === 'BUY') {
                                    g.long.b ++;
                                } else if (sgn.totalSignal === 'STRONG BUY') {
                                    g.long.sb ++;
                                }
                                $(`.${grp}.long-term`).html(`${g.long.b+g.long.sb}/${g.long.s+g.long.ss}`);
                                $(`.${grp}.long-term`).css("background", `linear-gradient( to right, lime, lime ${100*(g.long.b+g.long.sb)/(g.long.s+g.long.ss+g.long.b+g.long.sb)}%, red ${100*(g.long.b+g.long.sb)/(g.long.s+g.long.ss+g.long.b+g.long.sb)}%, red 100%)`);
                            } else if (sgn.strategy === 'cipShort'){
                                if (sgn.totalSignal === 'SELL') {
                                    g.short.s ++;
                                } else if (sgn.totalSignal === 'STRONG SELL') {
                                    g.short.ss ++;
                                } else if (sgn.totalSignal === 'BUY') {
                                    g.short.b ++;
                                } else if (sgn.totalSignal === 'STRONG BUY') {
                                    g.short.sb ++;
                                }
                                $(`.${grp}.short-term`).html(`${g.short.b+g.short.sb}/${g.short.s+g.short.ss}`);
                                $(`.${grp}.short-term`).css("background", `linear-gradient( to right, lime, lime ${100*(g.short.b+g.short.sb)/(g.short.s+g.short.ss+g.short.b+g.short.sb)}%, red ${100*(g.short.b+g.short.sb)/(g.short.s+g.short.ss+g.short.b+g.short.sb)}%, red 100%)`);
                            }
                        });
                    });
                }, "json")
            .done(function() {
                // 2ND SUCESS
            })
            .fail(function() {
                // ERROR
            })
            .always(function() {
                // FINISH
            });

        // Perform other work here ...

        // Set another completion function for the request above
        jqxhr.always(function() {
            // 2ND FINISH
        });
    });
};